// Awesomplete - Lea Verou - MIT license
!function(){function t(t,e){for(var i in t){var n=t[i],s=this.input.getAttribute("data-"+i.toLowerCase());this[i]="number"==typeof n?parseInt(s):n===!1?null!==s:n instanceof Function?null:s,this[i]||0===this[i]||(this[i]=i in e?e[i]:n)}}function e(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function i(t,e){return r.call((e||document).querySelectorAll(t))}function n(){i("input.awesomplete").forEach(function(t){new Awesomplete(t)})}var s=function(i,n){var r=this;this.input=e(i),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),n=n||{},t.call(this,{minChars:2,maxItems:10,autoFirst:!1,filter:s.FILTER_CONTAINS,sort:s.SORT_BYLENGTH,item:function(t,i){return e.create("li",{innerHTML:t.replace(RegExp(e.regExpEscape(i.trim()),"gi"),"<mark>$&</mark>"),"aria-selected":"false"})},replace:function(t){this.input.value=t}},n),this.index=-1,this.container=i.parentNode.className.search(/awesomplete/)<0?e.create("div",{className:"awesomplete",around:i}):i.parentNode,this.ul=e.create("ul",{hidden:"",inside:this.container}),this.status=e.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container}),e.bind(this.input,{input:this.evaluate.bind(this),blur:this.close.bind(this),keydown:function(t){var e=t.keyCode;r.opened&&(13===e&&r.selected?(t.preventDefault(),r.select()):27===e?r.close():(38===e||40===e)&&(t.preventDefault(),r[38===e?"previous":"next"]()))}}),e.bind(this.input.form,{submit:this.close.bind(this)}),e.bind(this.ul,{mousedown:function(t){var e=t.target;if(e!==this){for(;e&&!/li/i.test(e.nodeName);)e=e.parentNode;e&&r.select(e)}}}),this.input.hasAttribute("list")?(this.list="#"+i.getAttribute("list"),i.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||n.list||[],s.all.push(this)};s.prototype={set list(t){Array.isArray(t)?this._list=t:"string"==typeof t&&t.indexOf(",")>-1?this._list=t.split(/\s*,\s*/):(t=e(t),t&&t.children&&(this._list=r.apply(t.children).map(function(t){return t.textContent.trim()}))),document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.ul&&null==this.ul.getAttribute("hidden")},close:function(){this.ul.setAttribute("hidden",""),this.index=-1,e.fire(this.input,"awesomplete-close")},open:function(){this.ul.removeAttribute("hidden"),this.autoFirst&&-1===this.index&&this.goto(0),e.fire(this.input,"awesomplete-open")},next:function(){var t=this.ul.children.length;this.goto(this.index<t-1?this.index+1:-1)},previous:function(){var t=this.ul.children.length;this.goto(this.selected?this.index-1:t-1)},"goto":function(t){var i=this.ul.children;this.selected&&i[this.index].setAttribute("aria-selected","false"),this.index=t,t>-1&&i.length>0&&(i[t].setAttribute("aria-selected","true"),this.status.textContent=i[t].textContent),e.fire(this.input,"awesomplete-highlight")},select:function(t){if(t=t||this.ul.children[this.index]){var i;e.fire(this.input,"awesomplete-select",{text:t.textContent,preventDefault:function(){i=!0}}),i||(this.replace(t.textContent),this.close(),e.fire(this.input,"awesomplete-selectcomplete"))}},evaluate:function(){var t=this,e=this.input.value;e.length>=this.minChars&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this._list.filter(function(i){return t.filter(i,e)}).sort(this.sort).every(function(i,n){return t.ul.appendChild(t.item(i,e)),n<t.maxItems-1}),0===this.ul.children.length?this.close():this.open()):this.close()}},s.all=[],s.FILTER_CONTAINS=function(t,i){return RegExp(e.regExpEscape(i.trim()),"i").test(t)},s.FILTER_STARTSWITH=function(t,i){return RegExp("^"+e.regExpEscape(i.trim()),"i").test(t)},s.SORT_BYLENGTH=function(t,e){return t.length!==e.length?t.length-e.length:e>t?-1:1};var r=Array.prototype.slice;return e.create=function(t,i){var n=document.createElement(t);for(var s in i){var r=i[s];if("inside"===s)e(r).appendChild(n);else if("around"===s){var o=e(r);o.parentNode.insertBefore(n,o),n.appendChild(o)}else s in n?n[s]=r:n.setAttribute(s,r)}return n},e.bind=function(t,e){if(t)for(var i in e){var n=e[i];i.split(/\s+/).forEach(function(e){t.addEventListener(e,n)})}},e.fire=function(t,e,i){var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0);for(var s in i)n[s]=i[s];t.dispatchEvent(n)},e.regExpEscape=function(t){return t.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},"undefined"!=typeof Document&&("loading"!==document.readyState?n():document.addEventListener("DOMContentLoaded",n)),s.$=e,s.$$=i,"undefined"!=typeof self&&(self.Awesomplete=s),"object"==typeof exports&&(module.exports=s),s}();
//omnibar:
var idxOmnibar=function(jsonData){if(document.querySelector(".idx-omnibar-input")&&!document.querySelector(".awesomplete ul")){var cczList=[];Object.size=function(e){var a,i=0;for(a in e)e.hasOwnProperty(a)&&i++;return i};var forEach=function(e,a,i){for(var t=0;t<e.length;t++)a.call(i,t,e[t])},checkFieldName=function(fieldName){for(var displayName="",i=0;i<Object.size(customFieldsKey);i++){var systemName=Object.keys(customFieldsKey)[i],longName=eval('customFieldsKey["'+systemName+'"]');fieldName===systemName&&(displayName=longName)}return displayName},createArrays=function(e,a,i,t){return e.forEach("zip"===i?function(e){""!==e.name&&"Other"!==e.name&&"Other State"!==e.name&&a.push(e.name)}:"county"===i?function(e){""!==e.name&&"Other"!==e.name&&"Other State"!==e.name&&a.push(e.name+" County, "+e.stateAbrv)}:"city"===i?function(e){""!==e.name&&"Other"!==e.name&&"Other State"!==e.name&&a.push(e.name+", "+e.stateAbrv)}:function(e){""!==e&&"Other"!==e&&a.push(e+" "+checkFieldName(t))}),a},addAdvancedFields=function(newArray){for(var i=1;i<jsonData.length;i++)for(var idxID=Object.keys(jsonData[i])[0],fieldNumber=eval("Object.size(jsonData[i]."+idxID+")"),j=0;fieldNumber>j;j++){var fieldName=eval("Object.keys(jsonData[i]."+idxID+"[j])")[0],fieldValues=eval("jsonData[i]."+idxID+"[j]."+fieldName);createArrays(fieldValues,newArray,"custom",fieldName)}return cczList},buildLocationList=function(e){return addAdvancedFields(createArrays(e[0].core.zipcodes,createArrays(e[0].core.counties,createArrays(e[0].core.cities,cczList,"city"),"county"),"zip"))},removeDuplicates=function(e){for(var a={},i=[],t=e.length,n=0,r=0;t>r;r++){var o=e[r];1!==a[o]&&(a[o]=1,i[n++]=o)}return i};forEach(document.querySelectorAll(".idx-omnibar-input"),function(e,a){new Awesomplete(a,{autoFirst:!0}).list=removeDuplicates(buildLocationList(jsonData))});var foundResult=!1,goToResultsPage=function(e,a,i,t){return window.location=void 0!==t?a+i:a+i+setExtraFieldValues(e)},checkExtraFieldValues=function(e,a,i){return e.parentNode.parentNode.querySelector(".idx-omnibar-"+a).value?i+e.parentNode.parentNode.querySelector(".idx-omnibar-"+a).value:""},setExtraFieldValues=function(e){var a="";return a+=checkExtraFieldValues(e,"price","&hp="),a+=checkExtraFieldValues(e,"bed","&bd="),a+=checkExtraFieldValues(e,"bath","&tb=")},whatState=function(e,a,i){var t=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"Alberta",abbreviation:"AB"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"Baha California",abbreviation:"BC"},{name:"Bahamas",abbreviation:"BS"},{name:"British Columbia",abbreviation:"BC"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Jamaica",abbreviation:"JM"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Manitoba",abbreviation:"MB"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Mexico",abbreviation:"MX"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Brunswick",abbreviation:"NB"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"Newfoundland and Labrador",abbreviation:"NL"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Nova Scotia",abbreviation:"NS"},{name:"Northwest Territories",abbreviation:"NT"},{name:"Nunavut",abbreviation:"NU"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Ontario",abbreviation:"ON"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Prince Edward Island",abbreviation:"PE"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Quebec",abbreviation:"QC"},{name:"Rhode Island",abbreviation:"RI"},{name:"Saskatchewan",abbreviation:"SK"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"},{name:"Yukon",abbreviation:"YT"}];if(void 0===e||i)return!0;for(var n=0;n<t.length;n++)if((t[n].abbreviation===e.toUpperCase()||t[n].name.toUpperCase()===e.toUpperCase())&&t[n].abbreviation===a)return!0},isCounty=function(e,a){return void 0===e?!0:"counties"===a?!0:!1},checkAgainstList=function(e,a,i,t){var n=e.value.toLowerCase().split(", ")[0],r=!1;if("jc"===n){n="jc, "+e.value.toLowerCase().split(", ")[1];var r=!0}for(var o=0;o<a.length;o++)if(n.split(" county")[0]===a[o].name.toLowerCase()&&whatState(e.value.split(", ")[1],a[o].stateAbrv,r)&&isCounty(n.split(" county")[1],i)&&e.value)switch(i){case"cities":foundResult=!0,goToResultsPage(e,idxUrl,"?ccz=city&city[]="+a[o].id+"&widgetReferer=true");break;case"counties":foundResult=!0,goToResultsPage(e,idxUrl,"?ccz=county&county[]="+a[o].id+"&widgetReferer=true");break;case"zipcodes":foundResult=!0,goToResultsPage(e,idxUrl,"?ccz=zipcode&zipcode[]="+a[o].id+"&widgetReferer=true")}else if(foundResult===!1&&o==a.length-1)return t},advancedList=function(input){for(var i=1;i<jsonData.length;i++){for(var idxID=Object.keys(jsonData[i])[0],fieldNumber=eval("Object.size(jsonData[i]."+idxID+")"),j=0;j<mlsPtIDs.length;j++)if(keyIdxID=mlsPtIDs[j].idxID,keyMlsPtID=mlsPtIDs[j].mlsPtID,keyIdxID===idxID)var mlsPtID=keyMlsPtID;if(void 0===mlsPtID)var mlsPtID=1;for(var j=0;fieldNumber>j;j++){var fieldName=eval("Object.keys(jsonData[i]."+idxID+"[j])")[0],fieldValues=eval("jsonData[i]."+idxID+"[j]."+fieldName);if(forEach(fieldValues,function(e,a){return""===input.value||input.value.toLowerCase()!==a.toLowerCase()&&input.value.toLowerCase()!==(a+" "+checkFieldName(fieldName)).toLowerCase()?void 0:(foundResult=!0,goToResultsPage(input,idxUrl,"?pt="+mlsPtID+"&idxID="+idxID+"&aw_"+fieldName+"="+a+"&widgetReferer=true"))}),foundResult)return}}return foundResult===!1?notOnList(input):void 0},notOnList=function(e){var a=/\s/g.test(e.value);if(e.value)if(a===!1&&parseInt(e.value)!==isNaN){var i=!0;goToResultsPage(e,idxUrl,"?csv_listingID="+e.value,i+"&widgetReferer=true")}else{var t=e.value.split(" ");+t[0]>0?goToResultsPage(e,idxUrl,"?a_streetNumber="+t[0]+"&aw_streetName="+t[1]+"&widgetReferer=true"):e.value===idxOmnibarPlaceholder?goToResultsPage(e,idxUrl,"?widgetReferer=true"):goToResultsPage(e,idxUrl,"?aw_streetName="+e.value.split(", ")[0]+"&widgetReferer=true")}else goToResultsPage(e,idxUrl,"?widgetReferer=true")},runSearch=function(e){e.preventDefault();var a=e.target.querySelector(".idx-omnibar-input");checkAgainstList(a,jsonData[0].core.cities,"cities",checkAgainstList(a,jsonData[0].core.counties,"counties",checkAgainstList(a,jsonData[0].core.zipcodes,"zipcodes"))),foundResult===!1&&advancedList(a)};forEach(document.querySelectorAll(".idx-omnibar-form"),function(e,a){a.addEventListener("submit",runSearch)}),forEach(document.querySelectorAll(".idx-omnibar-original-form"),function(e,a){a.offsetWidth<400&&a.classList.add("idx-omnibar-mini")})}};