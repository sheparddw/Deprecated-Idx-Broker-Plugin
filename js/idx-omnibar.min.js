// Awesomplete - Lea Verou - MIT license
(function(){function m(a,b){for(var c in a){var g=a[c],e=this.input.getAttribute("data-"+c.toLowerCase());this[c]="number"===typeof g?parseInt(e):!1===g?null!==e:g instanceof Function?null:e;this[c]||0===this[c]||(this[c]=c in b?b[c]:g)}}function d(a,b){return"string"===typeof a?(b||document).querySelector(a):a||null}function h(a,b){return k.call((b||document).querySelectorAll(a))}function l(){h("input.awesomplete").forEach(function(a){new Awesomplete(a)})}var f=function(a,b){var c=this;this.input=
d(a);this.input.setAttribute("autocomplete","off");this.input.setAttribute("aria-autocomplete","list");b=b||{};m.call(this,{minChars:2,maxItems:10,autoFirst:!1,filter:f.FILTER_CONTAINS,sort:f.SORT_BYLENGTH,item:function(a,b){return d.create("li",{innerHTML:a.replace(RegExp(d.regExpEscape(b.trim()),"gi"),"<mark>$&</mark>"),"aria-selected":"false"})},replace:function(a){this.input.value=a}},b);this.index=-1;this.container=d.create("div",{className:"awesomplete",around:a});this.ul=d.create("ul",{hidden:"",
inside:this.container});this.status=d.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container});d.bind(this.input,{input:this.evaluate.bind(this),blur:this.close.bind(this),keydown:function(a){var b=a.keyCode;if(c.opened)if(13===b&&c.selected)a.preventDefault(),c.select();else if(27===b)c.close();else if(38===b||40===b)a.preventDefault(),c[38===b?"previous":"next"]()}});d.bind(this.input.form,{submit:this.close.bind(this)});
d.bind(this.ul,{mousedown:function(a){a=a.target;if(a!==this){for(;a&&!/li/i.test(a.nodeName);)a=a.parentNode;a&&c.select(a)}}});this.input.hasAttribute("list")?(this.list="#"+a.getAttribute("list"),a.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||b.list||[];f.all.push(this)};f.prototype={set list(a){Array.isArray(a)?this._list=a:"string"===typeof a&&-1<a.indexOf(",")?this._list=a.split(/\s*,\s*/):(a=d(a))&&a.children&&(this._list=k.apply(a.children).map(function(a){return a.textContent.trim()}));
document.activeElement===this.input&&this.evaluate()},get selected(){return-1<this.index},get opened(){return this.ul&&null==this.ul.getAttribute("hidden")},close:function(){this.ul.setAttribute("hidden","");this.index=-1;d.fire(this.input,"awesomplete-close")},open:function(){this.ul.removeAttribute("hidden");this.autoFirst&&-1===this.index&&this.goto(0);d.fire(this.input,"awesomplete-open")},next:function(){this.goto(this.index<this.ul.children.length-1?this.index+1:-1)},previous:function(){var a=
this.ul.children.length;this.goto(this.selected?this.index-1:a-1)},goto:function(a){var b=this.ul.children;this.selected&&b[this.index].setAttribute("aria-selected","false");this.index=a;-1<a&&0<b.length&&(b[a].setAttribute("aria-selected","true"),this.status.textContent=b[a].textContent);d.fire(this.input,"awesomplete-highlight")},select:function(a){if(a=a||this.ul.children[this.index]){var b;d.fire(this.input,"awesomplete-select",{text:a.textContent,preventDefault:function(){b=!0}});b||(this.replace(a.textContent),
this.close(),d.fire(this.input,"awesomplete-selectcomplete"))}},evaluate:function(){var a=this,b=this.input.value;b.length>=this.minChars&&0<this._list.length?(this.index=-1,this.ul.innerHTML="",this._list.filter(function(c){return a.filter(c,b)}).sort(this.sort).every(function(c,d){a.ul.appendChild(a.item(c,b));return d<a.maxItems-1}),0===this.ul.children.length?this.close():this.open()):this.close()}};f.all=[];f.FILTER_CONTAINS=function(a,b){return RegExp(d.regExpEscape(b.trim()),"i").test(a)};
f.FILTER_STARTSWITH=function(a,b){return RegExp("^"+d.regExpEscape(b.trim()),"i").test(a)};f.SORT_BYLENGTH=function(a,b){return a.length!==b.length?a.length-b.length:a<b?-1:1};var k=Array.prototype.slice;d.create=function(a,b){var c=document.createElement(a),g;for(g in b){var e=b[g];"inside"===g?d(e).appendChild(c):"around"===g?(e=d(e),e.parentNode.insertBefore(c,e),c.appendChild(e)):g in c?c[g]=e:c.setAttribute(g,e)}return c};d.bind=function(a,b){if(a)for(var c in b){var d=b[c];c.split(/\s+/).forEach(function(b){a.addEventListener(b,
d)})}};d.fire=function(a,b,c){var d=document.createEvent("HTMLEvents");d.initEvent(b,!0,!0);for(var e in c)d[e]=c[e];a.dispatchEvent(d)};d.regExpEscape=function(a){return a.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};"undefined"!==typeof Document&&("loading"!==document.readyState?l():document.addEventListener("DOMContentLoaded",l));f.$=d;f.$$=h;"undefined"!==typeof self&&(self.Awesomplete=f);"object"===typeof exports&&(module.exports=f);return f})();
//omnibar:
var idxOmnibar=function(jsonData){if(document.querySelector(".idx-omnibar-input")&&!document.querySelector(".awesomplete")){var cczList=[],mlsPtID=1;Object.size=function(a){var e,i=0;for(e in a)a.hasOwnProperty(e)&&i++;return i};var forEach=function(a,e,i){for(var n=0;n<a.length;n++)e.call(i,n,a[n])},checkFieldName=function(fieldName){for(var displayName="",i=0;i<Object.size(customFieldsKey);i++){var systemName=Object.keys(customFieldsKey)[i],longName=eval('customFieldsKey["'+systemName+'"]');fieldName===systemName&&(displayName=longName)}return displayName},createArrays=function(a,e,i,n){return a.forEach("zip"===i?function(a){""!==a.name&&"Other"!==a.name&&"Other State"!==a.name&&e.push(a.name)}:"county"===i?function(a){""!==a.name&&"Other"!==a.name&&"Other State"!==a.name&&e.push(a.name+" County, "+a.stateAbrv)}:"city"===i?function(a){""!==a.name&&"Other"!==a.name&&"Other State"!==a.name&&e.push(a.name+", "+a.stateAbrv)}:function(a){""!==a&&"Other"!==a&&e.push(a+" "+checkFieldName(n))}),e},addAdvancedFields=function(newArray){for(var i=1;i<jsonData.length;i++)for(var idxID=Object.keys(jsonData[i])[0],fieldNumber=eval("Object.size(jsonData[i]."+idxID+")"),j=0;fieldNumber>j;j++){var fieldName=eval("Object.keys(jsonData[i]."+idxID+"[j])")[0],fieldValues=eval("jsonData[i]."+idxID+"[j]."+fieldName);createArrays(fieldValues,newArray,"custom",fieldName)}return cczList},buildLocationList=function(a){return addAdvancedFields(createArrays(a[0].core.zipcodes,createArrays(a[0].core.counties,createArrays(a[0].core.cities,cczList,"city"),"county"),"zip"))},removeDuplicates=function(a){for(var e={},i=[],n=a.length,t=0,o=0;n>o;o++){var r=a[o];1!==e[r]&&(e[r]=1,i[t++]=r)}return i};forEach(document.querySelectorAll(".idx-omnibar-input"),function(a,e){new Awesomplete(e,{autoFirst:!0}).list=removeDuplicates(buildLocationList(jsonData))});var foundResult=!1,goToResultsPage=function(a,e,i,n){return window.location=void 0!==n?e+i:e+i+setExtraFieldValues(a)},checkExtraFieldValues=function(a,e,i){return a.parentNode.parentNode.querySelector(".idx-omnibar-"+e).value?i+a.parentNode.parentNode.querySelector(".idx-omnibar-"+e).value:""},setExtraFieldValues=function(a){var e="";return e+=checkExtraFieldValues(a,"price","&hp="),e+=checkExtraFieldValues(a,"bed","&bd="),e+=checkExtraFieldValues(a,"bath","&tb=")},whatState=function(a,e,i){var n=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"Alberta",abbreviation:"AB"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"Baha California",abbreviation:"BC"},{name:"Bahamas",abbreviation:"BS"},{name:"British Columbia",abbreviation:"BC"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Jamaica",abbreviation:"JM"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Manitoba",abbreviation:"MB"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Mexico",abbreviation:"MX"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Brunswick",abbreviation:"NB"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"Newfoundland and Labrador",abbreviation:"NL"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Nova Scotia",abbreviation:"NS"},{name:"Northwest Territories",abbreviation:"NT"},{name:"Nunavut",abbreviation:"NU"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Ontario",abbreviation:"ON"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Prince Edward Island",abbreviation:"PE"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Quebec",abbreviation:"QC"},{name:"Rhode Island",abbreviation:"RI"},{name:"Saskatchewan",abbreviation:"SK"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"},{name:"Yukon",abbreviation:"YT"}];if(void 0===a||i)return!0;for(var t=0;t<n.length;t++)if((n[t].abbreviation===a.toUpperCase()||n[t].name.toUpperCase()===a.toUpperCase())&&n[t].abbreviation===e)return!0},isCounty=function(a,e){return void 0===a?!0:"counties"===e?!0:!1},checkAgainstList=function(a,e,i,n){var t=a.value.toLowerCase().split(", ")[0],o=!1;if("jc"===t){t="jc, "+a.value.toLowerCase().split(", ")[1];var o=!0}for(var r=0;r<e.length;r++)if(t.split(" county")[0]===e[r].name.toLowerCase()&&whatState(a.value.split(", ")[1],e[r].stateAbrv,o)&&isCounty(t.split(" county")[1],i)&&a.value)switch(i){case"cities":foundResult=!0,goToResultsPage(a,idxUrl,"?ccz=city&city[]="+e[r].id);break;case"counties":foundResult=!0,goToResultsPage(a,idxUrl,"?ccz=county&county[]="+e[r].id);break;case"zipcodes":foundResult=!0,goToResultsPage(a,idxUrl,"?ccz=zipcode&zipcode[]="+e[r].id)}else if(foundResult===!1&&r==e.length-1)return n},advancedList=function(input){for(var i=1;i<jsonData.length;i++)for(var idxID=Object.keys(jsonData[i])[0],fieldNumber=eval("Object.size(jsonData[i]."+idxID+")"),j=0;fieldNumber>j;j++){var fieldName=eval("Object.keys(jsonData[i]."+idxID+"[j])")[0],fieldValues=eval("jsonData[i]."+idxID+"[j]."+fieldName);forEach(fieldValues,function(a,e){(input.value.toLowerCase()===e.toLowerCase()||input.value.toLowerCase()===(e+" "+checkFieldName(fieldName)).toLowerCase())&&(foundResult=!0,goToResultsPage(input,idxUrl,"?pt="+mlsPtID+"&idxID="+idxID+"&aw_"+fieldName+"="+e))})}},notOnList=function(a){var e=/\s/g.test(a.value);if(a.value)if(e===!1&&parseInt(a.value)!==isNaN){var i=!0;goToResultsPage(a,idxUrl,"?csv_listingID="+a.value,i)}else{var n=a.value.split(" ");+n[0]>0?goToResultsPage(a,idxUrl,"?a_streetNumber="+n[0]+"&aw_streetName="+n[1]):"City,"===n[0]?goToResultsPage(a,idxUrl,"?pt=all"):goToResultsPage(a,idxUrl,"?aw_streetName="+a.value.split(", ")[0])}else goToResultsPage(a,idxUrl,"?pt=all")},runSearch=function(a){a.preventDefault();var e=a.target.querySelector(".idx-omnibar-input");checkAgainstList(e,jsonData[0].core.cities,"cities",checkAgainstList(e,jsonData[0].core.counties,"counties",checkAgainstList(e,jsonData[0].core.zipcodes,"zipcodes"))),foundResult===!1&&advancedList(e)};forEach(document.querySelectorAll(".idx-omnibar-form"),function(a,e){e.addEventListener("submit",runSearch)}),forEach(document.querySelectorAll(".idx-omnibar-original-form"),function(a,e){e.offsetWidth<400&&e.classList.add("idx-omnibar-mini")})}};